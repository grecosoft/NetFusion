version: 3.2.{build}
image: Visual Studio 2017

pull_requests:
  do_not_increment_build_number: true

before_build:
  - ps: dotnet restore ./netfusion/NetFusion.sln

build_script:
  - ps: msbuild "/t:Restore;Pack" .\netfusion\NetFusion.sln /p:VersionPrefix="$env:APPVEYOR_BUILD_VERSION"
  
test_script:
  - ps: dotnet test .\netfusion\test\CommonTests\CommonTests.csproj 
  - ps: dotnet test .\netfusion\test\CoreTests\CoreTests.csproj
  - ps: dotnet test .\netfusion\test\WebTests\WebTests.csproj
  - ps: dotnet test .\netfusion\test\IntegrationTests\IntegrationTests.csproj
  
artifacts:
  - path: netfusion\src\**\*.nupkg
    name: MyGet
    
deploy:
  - provider: NuGet
    artifact: MyGet
    api_key:
      secure: c/FNue2mw27B5A0B1V+pAtSl22XoSqSMu6pj8xIlKGdwAEqoCq7HRxtTqsJl/m1L
    skip_symbols: false

skip_commits:
  message: /\[nobuild\]/
  files:
    - '**/*.md'
    - 'clients\**\*'
    - 'examples\**\*'
    - 'tools\**\*'
    - 'img\**\*'

  

