version: 3.2.{build}
image: Visual Studio 2019

branches:
  only:
    - master

pull_requests:
  do_not_increment_build_number: true

before_build:
  - ps: dotnet restore ./netfusion/NetFusion.sln

build_script:
  - ps: msbuild "/t:Restore;Pack" .\netfusion\NetFusion.sln /p:VersionPrefix="$env:APPVEYOR_BUILD_VERSION"
  
test_script:
  - ps: dotnet test .\netfusion\test\CommonTests\CommonTests.csproj 
  - ps: dotnet test .\netfusion\test\CoreTests\CoreTests.csproj
  - ps: dotnet test .\netfusion\test\WebTests\WebTests.csproj
  - ps: dotnet test .\netfusion\test\IntegrationTests\IntegrationTests.csproj
  
artifacts:
  - path: netfusion\src\**\*.nupkg
    name: MyGet
    
deploy:
  - provider: NuGet
    artifact: MyGet
    api_key:
      secure: YKKQNTAaM2LHNFWGxRysc2gGMcrc0hlyoQHNH5+TwLb0KTZR6fINL/MEQU0Y2S1L
    skip_symbols: true

skip_commits:
  message: /\[nobuild\]/
  files:
    - '**/*.md'
    - 'clients\**\*'
    - 'examples\**\*'
    - 'img\**\*'
    - 'packages\**\*'
    - 'tools\**\*'
    - 'tutorial\**\*'
